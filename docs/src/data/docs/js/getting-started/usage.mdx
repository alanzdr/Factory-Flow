---
title: "Usage"
---


## Install the package

To get started, check out the [Installation](/docs/js/getting-started/installation) guide.

## Create a Robot

Create a folder to store your robots, and create a file for each robot, each robot must extend the `Robot` class, and implement the `execute` method.

<b>Robot to Fetch Images URL </b>

```ts
// robots/fetchImages.ts
import { Robot } from "factory-flow/core";

class FetchImagesRobot extends Robot {
  async execute(): Promise<void> {
    const images: string[] = [];
    // ... your code to get the images here
    this.state.set("images", images);
    // OR
    this.state.set("images", (oldImages) => {
      return [...oldImages, ...images];
    });
  }
}

export default FetchImagesRobot;
```
<b>Robot to download the images</b>

```ts
// robots/downloadImages.ts
import { Robot } from "factory-flow/core";

class DownloadImagesRobot extends Robot {
  async execute(): Promise<void> {
    const images: string[] = this.state.get("images");
    const alreadyDownloaded: string[] = 
      this.state.get("downloaded") || [];

    for (const image of images) {
      if (alreadyDownloaded.includes(image)) {
        continue;
      }
      // ... your code to download the images here
      alreadyDownloaded.push(image);
      // Save the state after each download
      // to avoid downloading the same image again
      this.state.set("downloaded", alreadyDownloaded);
      await this.state.save();
    }
  }
}

export default DownloadImagesRobot;
```

## Create the State Manager

Create a state for the factory, you can create it from scratch by extending the "FactoryState" class, or use a ready-made state in the library.

<b>Using a JSON file</b>

```ts
// state.ts
import { JSONState } from "factory-flow/core";

interface State {
  images: string[];
  downloaded: string[];
}

const initialState: State = {
  images: [],
  downloaded: [],
};

const __filename = fileURLToPath(import.meta.url);
const statePath = path.resolve(path.dirname(__filename), "state.json");

const state = new JSONState<State>(initialState, statePath);

export default state;
```

<b>Creating a custom state</b>

```ts
// state.ts
import { FactoryState } from "factory-flow/core";

interface State {
  images: string[];
  downloaded: string[];
}

class CustomState extends FactoryState<State> {
  constructor(initialState: State) {
    super(initialState);
  }

  public async initialize(): Promise<boolean> {
    // Your code to initialize the state
    // This is where you will load the state already 
    // saved at the beginning of the execution
    return true;
  }

  public async save() {
    // Your code to save the state
    // This is where you will save the state after each update
  }
}

const initialState: State = {
  images: [],
  downloaded: [],
};

const state = new CustomState(initialState);

export default state;
```

### Make your robots know the State

Pass the State Class as the first Generic when extending the Robot, now when you call `this.state` inside the robot, it will be typed with the state you passed.

```ts
// robots/fetchImages.ts
import CustomState from '../state';
import { Robot } from "factory-flow/core";

class FetchImagesRobot extends Robot<CustomState> {
  async execute(): Promise<void> {
    // return the type that was declared in the state, 
    // in this case, string[]
    const images = this.state.get("images");
    // ... your code to get the images here
    this.state.set("images", images);
  }
}

export default FetchImagesRobot;
```

## Create and Execute the Factory Flow

- Create the factory flow, and add the robots to the factory, the factory will be responsible for executing the robots in the correct order.
- Here you can add as if they were blocks, and you can always remove or add a new `Robot` in any position.
- After adding the robots, the `.execute()` method must be called for the factory to begin the process.

```ts
// factory.ts
import { Factory } from "factory-flow/core";

import FetchImagesRobot from "./robots/fetchImages";
import DownloadImagesRobot from "./robots/downloadImages";
import state from "./state";

// Create and execute the factory flow
Factory.createFlow(state)
  .pipe(FetchImagesRobot)
  .pipe(DownloadImagesRobot)
  .execute();

// OR

async function runImageDownloadFactory() {
  const factory = await Factory
    .createFlow(state)
    .pipe(FetchImagesRobot)
    .pipe(DownloadImagesRobot)
    .execute();
  // You can access the state after the execution
  console.log(factory.state.get("downloaded"));
}

```